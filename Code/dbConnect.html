<!-- No longer in use, just initial code to connect to firebase -->
<!-- Use for reference in database connection for other pages -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create User Profile</title>
</head>

<body>
    <h1>Create Your User Profile</h1>

    <br><br>
    <input type="text" id="userName" placeholder="Your Name">
    <button id="createProfileButton" disabled>Create Profile</button>
    <p id="statusMessage"></p>

    <!-- Firebase SDKs - make sure these are loaded from a CDN or your build process -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdycuLXCIq2xr5zk2Snbw4cihQUR5vjY4",
            authDomain: "found-5ecc0.firebaseapp.com",
            projectId: "found-5ecc0",
            storageBucket: "found-5ecc0.firebasestorage.app",
            messagingSenderId: "160156481057",
            appId: "1:160156481057:web:92b9f5569cdd89b0f3d560"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);


        const userNameInput = document.getElementById('userName');
        const createProfileButton = document.getElementById('createProfileButton');
        const statusMessage = document.getElementById('statusMessage');

        let currentUser = null;

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                statusMessage.textContent = `Signed in as: ${user.uid}`;
                createProfileButton.disabled = false;
            } else {
                currentUser = null;
                statusMessage.textContent = 'Not signed in.';
                createProfileButton.disabled = true;
            }
        });

        // Create profile document
        createProfileButton.addEventListener('click', async () => {
            if (!currentUser) {
                statusMessage.textContent = "Please sign in first!";
                return;
            }

            const name = userNameInput.value.trim();
            if (!name) {
                statusMessage.textContent = "Please enter a name.";
                return;
            }

            const userDocRef = doc(db, 'users', currentUser.uid); // Use user's UID as document ID

            try {
                await addDoc(userDocRef, {
                    name: name,
                    email: currentUser.email, // If anonymous, email might be null
                    createdAt: new Date(),
                    uid: currentUser.uid
                });
                statusMessage.textContent = `Profile created successfully for ${name}!`;
                console.log("Document written with ID: ", currentUser.uid);
            } catch (e) {
                console.error("Error adding document: ", e);
                statusMessage.textContent = `Error creating profile: ${e.message}`;
            }
        });

    </script>
</body>

</html>
